<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>상담 상태 조회</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header">
  <h1>상담 상태 조회</h1>
  <p class="subtitle">제출 시 받은 링크(토큰)로 접속해야 조회됩니다.</p>
</header>

<main class="container">
  <section class="card">
    <div id="statusArea">
      <p class="muted">불러오는 중…</p>
    </div>
  </section>
  <p class="help">상태는 교사가 업데이트하면 즉시 반영됩니다.</p>
</main>

<script>
  const ENDPOINT = "https://script.google.com/macros/s/AKfycbzJYR2iJNTBndvkJmiRqooR-Q0rh7baUzrqECc0W9kPbTTCy0zcMBSyQyk9eTpXLwX1Vg/exec"; // 아래 Apps Script 배포 URL
  const params = new URLSearchParams(location.search);
  const token = params.get("token");

  async function fetchStatus(){
    const box = document.getElementById('statusArea');
    if(!token){ box.innerHTML = '<p class="error">토큰이 없습니다. 제출 완료 후 받은 링크로 접속해 주세요.</p>'; return; }
    try{
      const res = await fetch(`${ENDPOINT}?token=${encodeURIComponent(token)}`);
      const data = await res.json();
      if(!data.ok){ throw new Error(data.error || '조회 실패'); }
      const r = data.record;
      box.innerHTML = `
        <h2>${r.studentName} 학부모님 접수건</h2>
        <ul class="status-list">
          <li><b>현재 상태:</b> ${r.status}</li>
          <li><b>접수일시:</b> ${r.createdAt}</li>
          <li><b>주제/긴급도:</b> ${r.topic} / ${r.priority}</li>
          <li><b>희망 연락:</b> ${r.preferredTime || '-'}</li>
        </ul>
        <h3>상세 내용</h3>
        <pre class="preview">${r.message}</pre>
        ${r.teacherNote ? `<h3>교사 메모/답신 요약</h3><pre class="preview">${r.teacherNote}</pre>` : ''}
      `;
    }catch(err){
      document.getElementById('statusArea').innerHTML =
        `<p class="error">조회에 문제가 있습니다. 링크가 맞는지 확인해 주세요.</p>`;
      console.error(err);
    }
  }
  fetchStatus();
</script>
</body>
</html>

